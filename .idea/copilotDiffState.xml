<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/swieczkomat/ui/dialogs/MaterialDialogs.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/swieczkomat/ui/dialogs/MaterialDialogs.kt" />
              <option name="originalContent" value="package com.example.swieczkomat.ui.dialogs&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.compose.ui.window.Dialog&#10;import com.example.swieczkomat.data.Material&#10;import java.util.Locale&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun AddMaterialDialog(&#10;    onDismiss: () -&gt; Unit,&#10;    onAddMaterial: (Material) -&gt; Unit,&#10;    darkMode: Boolean,&#10;    existingMaterials: List&lt;Material&gt;&#10;) {&#10;    var materialName by remember { mutableStateOf(&quot;&quot;) }&#10;    var quantity by remember { mutableStateOf(&quot;&quot;) }&#10;    var capacityValue by remember { mutableStateOf(&quot;&quot;) }&#10;    val capacityUnits = listOf(&quot;ml&quot;, &quot;g&quot;)&#10;    var capacityUnit by remember { mutableStateOf(capacityUnits.first()) }&#10;    var preferredWickName by remember { mutableStateOf(&quot;&quot;) }&#10;    var preferredConcentration by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    val unitsBase = listOf(&quot;g&quot;, &quot;ml&quot;, &quot;szt&quot;, &quot;m&quot;)&#10;    var unit by remember { mutableStateOf(&quot;g&quot;) }&#10;    val categories = listOf(&quot;Wosk&quot;, &quot;Olejek&quot;, &quot;Knot&quot;, &quot;Pojemnik&quot;, &quot;Barwnik&quot;, &quot;Inne&quot;)&#10;    var category by remember { mutableStateOf(categories.first()) }&#10;&#10;    var nameExpanded by remember { mutableStateOf(false) }&#10;    val allMaterialNames = existingMaterials.map { it.name }.distinct()&#10;    val filteredMaterialNames = if (materialName.isBlank()) allMaterialNames else allMaterialNames.filter { it.contains(materialName, ignoreCase = true) }&#10;&#10;    val wicks = existingMaterials.filter { it.category == &quot;Knot&quot; }.map { it.name }&#10;&#10;    LaunchedEffect(category) {&#10;        unit = when (category) {&#10;            &quot;Pojemnik&quot; -&gt; &quot;szt&quot;&#10;            &quot;Knot&quot; -&gt; &quot;szt&quot;&#10;            &quot;Olejek&quot; -&gt; &quot;ml&quot;&#10;            else -&gt; &quot;g&quot;&#10;        }&#10;    }&#10;&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(&#10;            modifier = Modifier.padding(16.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = if (darkMode) Color(0xFF3B3B44) else Color.White)&#10;        ) {&#10;            Column(modifier = Modifier.padding(16.dp).fillMaxWidth()) {&#10;                Text(&quot;Dodaj nowy materiał&quot;, fontSize = 20.sp, fontWeight = FontWeight.SemiBold, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(16.dp))&#10;&#10;                // Nazwa + podpowiedzi&#10;                ExposedDropdownMenuBox(expanded = nameExpanded, onExpandedChange = { nameExpanded = !nameExpanded }) {&#10;                    OutlinedTextField(&#10;                        modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                        value = materialName,&#10;                        onValueChange = {&#10;                            materialName = it&#10;                            nameExpanded = true // otwórz menu przy wpisywaniu&#10;                        },&#10;                        label = { Text(&quot;Nazwa materiału&quot;) },&#10;                        trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = nameExpanded) }&#10;                    )&#10;                    if (nameExpanded &amp;&amp; filteredMaterialNames.isNotEmpty()) {&#10;                        ExposedDropdownMenu(expanded = nameExpanded, onDismissRequest = { nameExpanded = false }) {&#10;                            filteredMaterialNames.forEach { option -&gt;&#10;                                DropdownMenuItem(text = { Text(option) }, onClick = {&#10;                                    val selected = existingMaterials.find { it.name == option }&#10;                                    if (selected != null) {&#10;                                        category = selected.category&#10;                                        unit = selected.unit&#10;                                        preferredWickName = selected.preferredWickName ?: &quot;&quot;&#10;                                        preferredConcentration = selected.preferredConcentration?.toString() ?: &quot;&quot;&#10;                                        if (selected.category == &quot;Pojemnik&quot;) {&#10;                                            // wyodrębnij pojemność i jednostkę&#10;                                            val lastSpace = selected.name.lastIndexOf(' ')&#10;                                            if (lastSpace != -1) {&#10;                                                materialName = selected.name.substring(0, lastSpace)&#10;                                                val tail = selected.name.substring(lastSpace + 1)&#10;                                                val value = tail.filter { it.isDigit() }&#10;                                                val unitStr = tail.filter { it.isLetter() }&#10;                                                capacityValue = value&#10;                                                if (unitStr in capacityUnits) capacityUnit = unitStr&#10;                                            } else materialName = selected.name&#10;                                        } else materialName = selected.name&#10;                                    } else materialName = option&#10;                                    nameExpanded = false&#10;                                })&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                // Kategoria&#10;                var categoryExpanded by remember { mutableStateOf(false) }&#10;                ExposedDropdownMenuBox(expanded = categoryExpanded, onExpandedChange = { categoryExpanded = !categoryExpanded }) {&#10;                    OutlinedTextField(&#10;                        modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                        readOnly = true,&#10;                        value = category,&#10;                        onValueChange = {},&#10;                        label = { Text(&quot;Kategoria&quot;) },&#10;                        trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = categoryExpanded) }&#10;                    )&#10;                    ExposedDropdownMenu(expanded = categoryExpanded, onDismissRequest = { categoryExpanded = false }) {&#10;                        categories.forEach { option -&gt; DropdownMenuItem(text = { Text(option) }, onClick = { category = option; categoryExpanded = false }) }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                // Dynamiczne pola zależne od kategorii&#10;                when (category) {&#10;                    &quot;Pojemnik&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = capacityValue,&#10;                                onValueChange = { capacityValue = it },&#10;                                label = { Text(&quot;Pojemność&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var capUnitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = capUnitExpanded, onExpandedChange = { capUnitExpanded = !capUnitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = capacityUnit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = capUnitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = capUnitExpanded, onDismissRequest = { capUnitExpanded = false }) {&#10;                                    capacityUnits.forEach { cu -&gt; DropdownMenuItem(text = { Text(cu) }, onClick = { capacityUnit = cu; capUnitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = quantity,&#10;                            onValueChange = { quantity = it },&#10;                            label = { Text(&quot;Ilość (szt.)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                        )&#10;                        Spacer(Modifier.height(8.dp))&#10;                        // Preferowany knot&#10;                        var wickExpanded by remember { mutableStateOf(false) }&#10;                        ExposedDropdownMenuBox(expanded = wickExpanded, onExpandedChange = { wickExpanded = !wickExpanded }) {&#10;                            OutlinedTextField(&#10;                                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                                readOnly = true,&#10;                                value = preferredWickName,&#10;                                onValueChange = {},&#10;                                label = { Text(&quot;Preferowany knot&quot;) },&#10;                                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = wickExpanded) }&#10;                            )&#10;                            ExposedDropdownMenu(expanded = wickExpanded, onDismissRequest = { wickExpanded = false }) {&#10;                                wicks.forEach { w -&gt; DropdownMenuItem(text = { Text(w) }, onClick = { preferredWickName = w; wickExpanded = false }) }&#10;                            }&#10;                        }&#10;                    }&#10;                    &quot;Olejek&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            // Jednostka dla olejku (ml/g) uproszczenie&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    listOf(&quot;ml&quot;, &quot;g&quot;).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = preferredConcentration,&#10;                            onValueChange = { preferredConcentration = it },&#10;                            label = { Text(&quot;Preferowane stężenie (%)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                        )&#10;                    }&#10;                    else -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    (if (category == &quot;Knot&quot;) listOf(&quot;szt&quot;, &quot;m&quot;) else unitsBase).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;                var price by remember { mutableStateOf(&quot;&quot;) }&#10;                OutlinedTextField(&#10;                    value = price,&#10;                    onValueChange = { price = it },&#10;                    label = { Text(&quot;Cena całkowita (zł)&quot;) },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                )&#10;                Spacer(Modifier.height(16.dp))&#10;                Row(modifier = Modifier.align(Alignment.End)) {&#10;                    TextButton(onClick = onDismiss) { Text(&quot;Anuluj&quot;) }&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Button(onClick = {&#10;                        val finalName = if (category == &quot;Pojemnik&quot;) {&#10;                            &quot;${materialName.trim()} ${capacityValue.trim()}${capacityUnit}&quot;.trim()&#10;                        } else materialName.trim()&#10;                        val finalUnit = if (category == &quot;Pojemnik&quot;) &quot;szt&quot; else unit&#10;                        val newMaterial = Material(&#10;                            name = finalName,&#10;                            quantity = quantity.toDoubleOrNull() ?: 0.0,&#10;                            unit = finalUnit,&#10;                            price = price.toDoubleOrNull() ?: 0.0,&#10;                            category = category,&#10;                            preferredWickName = if (category == &quot;Pojemnik&quot;) preferredWickName.takeIf { it.isNotBlank() } else null,&#10;                            preferredConcentration = if (category == &quot;Olejek&quot;) preferredConcentration.toDoubleOrNull() else null&#10;                        )&#10;                        onAddMaterial(newMaterial)&#10;                    }, colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF7C3AED))) { Text(&quot;Dodaj&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun EditMaterialDialog(&#10;    material: Material,&#10;    onDismiss: () -&gt; Unit,&#10;    onEditMaterial: (Material) -&gt; Unit,&#10;    darkMode: Boolean,&#10;    existingMaterials: List&lt;Material&gt;&#10;) {&#10;    var materialName by remember { mutableStateOf(material.name) }&#10;    var quantity by remember { mutableStateOf(material.quantity.toString()) }&#10;    var capacityValue by remember { mutableStateOf(&quot;&quot;) }&#10;    val capacityUnits = listOf(&quot;ml&quot;, &quot;g&quot;)&#10;    var capacityUnit by remember { mutableStateOf(capacityUnits.first()) }&#10;    var preferredWickName by remember { mutableStateOf(material.preferredWickName ?: &quot;&quot;) }&#10;    var preferredConcentration by remember { mutableStateOf(material.preferredConcentration?.toString() ?: &quot;&quot;) }&#10;    var unit by remember { mutableStateOf(material.unit) }&#10;    val categories = listOf(&quot;Wosk&quot;, &quot;Olejek&quot;, &quot;Knot&quot;, &quot;Pojemnik&quot;, &quot;Barwnik&quot;, &quot;Inne&quot;)&#10;    var category by remember { mutableStateOf(material.category) }&#10;&#10;    LaunchedEffect(material) {&#10;        if (material.category == &quot;Pojemnik&quot;) {&#10;            val lastSpace = material.name.lastIndexOf(' ')&#10;            if (lastSpace != -1) {&#10;                materialName = material.name.substring(0, lastSpace)&#10;                val tail = material.name.substring(lastSpace + 1)&#10;                val value = tail.filter { it.isDigit() }&#10;                val unitStr = tail.filter { it.isLetter() }&#10;                capacityValue = value&#10;                if (unitStr in capacityUnits) capacityUnit = unitStr&#10;            }&#10;        }&#10;    }&#10;&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(&#10;            modifier = Modifier.padding(16.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = if (darkMode) Color(0xFF3B3B44) else Color.White)&#10;        ) {&#10;            Column(modifier = Modifier.padding(16.dp).fillMaxWidth()) {&#10;                Text(&quot;Edytuj materiał&quot;, fontSize = 20.sp, fontWeight = FontWeight.SemiBold, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(16.dp))&#10;                OutlinedTextField(&#10;                    value = materialName,&#10;                    onValueChange = { materialName = it },&#10;                    label = { Text(&quot;Nazwa materiału&quot;) },&#10;                    modifier = Modifier.fillMaxWidth()&#10;                )&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                var categoryExpanded by remember { mutableStateOf(false) }&#10;                ExposedDropdownMenuBox(expanded = categoryExpanded, onExpandedChange = { categoryExpanded = !categoryExpanded }) {&#10;                    OutlinedTextField(&#10;                        modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                        readOnly = true,&#10;                        value = category,&#10;                        onValueChange = {},&#10;                        label = { Text(&quot;Kategoria&quot;) },&#10;                        trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = categoryExpanded) }&#10;                    )&#10;                    ExposedDropdownMenu(expanded = categoryExpanded, onDismissRequest = { categoryExpanded = false }) {&#10;                        categories.forEach { option -&gt; DropdownMenuItem(text = { Text(option) }, onClick = { category = option; categoryExpanded = false }) }&#10;                    }&#10;                }&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                when (category) {&#10;                    &quot;Pojemnik&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = capacityValue,&#10;                                onValueChange = { capacityValue = it },&#10;                                label = { Text(&quot;Pojemność&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var capUnitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = capUnitExpanded, onExpandedChange = { capUnitExpanded = !capUnitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = capacityUnit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = capUnitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = capUnitExpanded, onDismissRequest = { capUnitExpanded = false }) {&#10;                                    capacityUnits.forEach { cu -&gt; DropdownMenuItem(text = { Text(cu) }, onClick = { capacityUnit = cu; capUnitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = quantity,&#10;                            onValueChange = { quantity = it },&#10;                            label = { Text(&quot;Ilość (szt.)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                        )&#10;                        Spacer(Modifier.height(8.dp))&#10;                        var wickExpanded by remember { mutableStateOf(false) }&#10;                        val wicks = existingMaterials.filter { it.category == &quot;Knot&quot; }.map { it.name }&#10;                        ExposedDropdownMenuBox(expanded = wickExpanded, onExpandedChange = { wickExpanded = !wickExpanded }) {&#10;                            OutlinedTextField(&#10;                                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                                readOnly = true,&#10;                                value = preferredWickName,&#10;                                onValueChange = {},&#10;                                label = { Text(&quot;Preferowany knot&quot;) },&#10;                                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = wickExpanded) }&#10;                            )&#10;                            ExposedDropdownMenu(expanded = wickExpanded, onDismissRequest = { wickExpanded = false }) {&#10;                                wicks.forEach { w -&gt; DropdownMenuItem(text = { Text(w) }, onClick = { preferredWickName = w; wickExpanded = false }) }&#10;                            }&#10;                        }&#10;                    }&#10;                    &quot;Olejek&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    listOf(&quot;ml&quot;, &quot;g&quot;).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = preferredConcentration,&#10;                            onValueChange = { preferredConcentration = it },&#10;                            label = { Text(&quot;Preferowane stężenie (%)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                        )&#10;                    }&#10;                    else -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            val unitsBase = listOf(&quot;g&quot;, &quot;ml&quot;, &quot;szt&quot;, &quot;m&quot;)&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    (if (category == &quot;Knot&quot;) listOf(&quot;szt&quot;, &quot;m&quot;) else unitsBase).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;                var price by remember { mutableStateOf(material.price.toString()) }&#10;                OutlinedTextField(&#10;                    value = price,&#10;                    onValueChange = { price = it },&#10;                    label = { Text(&quot;Cena całkowita (zł)&quot;) },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                )&#10;                Spacer(Modifier.height(16.dp))&#10;                Row(modifier = Modifier.align(Alignment.End)) {&#10;                    TextButton(onClick = onDismiss) { Text(&quot;Anuluj&quot;) }&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Button(onClick = {&#10;                        val finalName = if (category == &quot;Pojemnik&quot;) {&#10;                            &quot;${materialName.trim()} ${capacityValue.trim()}${capacityUnit}&quot;.trim()&#10;                        } else materialName.trim()&#10;                        val finalUnit = if (category == &quot;Pojemnik&quot;) &quot;szt&quot; else unit&#10;                        val updated = material.copy(&#10;                            name = finalName,&#10;                            quantity = quantity.toDoubleOrNull() ?: 0.0,&#10;                            unit = finalUnit,&#10;                            price = price.toDoubleOrNull() ?: 0.0,&#10;                            category = category,&#10;                            preferredWickName = if (category == &quot;Pojemnik&quot;) preferredWickName.takeIf { it.isNotBlank() } else null,&#10;                            preferredConcentration = if (category == &quot;Olejek&quot;) preferredConcentration.toDoubleOrNull() else null&#10;                        )&#10;                        onEditMaterial(updated)&#10;                    }, colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF7C3AED))) { Text(&quot;Zapisz&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun RemoveMaterialDialog(&#10;    material: Material,&#10;    onDismiss: () -&gt; Unit,&#10;    onRemove: (Material, Double) -&gt; Unit,&#10;    darkMode: Boolean&#10;) {&#10;    var quantityToRemove by remember { mutableStateOf(&quot;&quot;) }&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(shape = RoundedCornerShape(16.dp), colors = CardDefaults.cardColors(containerColor = if (darkMode) Color(0xFF3B3B44) else Color.White)) {&#10;            Column(modifier = Modifier.padding(16.dp).fillMaxWidth(), horizontalAlignment = Alignment.Start) {&#10;                Text(&quot;Usuń materiał&quot;, fontSize = 20.sp, fontWeight = FontWeight.SemiBold, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(16.dp))&#10;                Text(String.format(Locale.getDefault(), &quot;Dostępna ilość: %.2f %s&quot;, material.quantity, material.unit), fontSize = 14.sp, color = if (darkMode) Color(0xFF9CA3AF) else Color(0xFF6B7280))&#10;                Spacer(Modifier.height(8.dp))&#10;                OutlinedTextField(value = quantityToRemove, onValueChange = { quantityToRemove = it }, label = { Text(&quot;Ilość do usunięcia&quot;) }, keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number))&#10;                Spacer(Modifier.height(8.dp))&#10;                TextButton(onClick = { quantityToRemove = String.format(Locale.getDefault(), &quot;%.2f&quot;, material.quantity) }) { Text(&quot;Wszystko&quot;) }&#10;                Spacer(Modifier.height(16.dp))&#10;                Row(modifier = Modifier.align(Alignment.End)) {&#10;                    TextButton(onClick = onDismiss) { Text(&quot;Anuluj&quot;) }&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Button(onClick = { onRemove(material, quantityToRemove.toDoubleOrNull() ?: 0.0) }, colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFEC4899))) { Text(&quot;Usuń&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.swieczkomat.ui.dialogs&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.compose.ui.window.Dialog&#10;import com.example.swieczkomat.data.Material&#10;import java.util.Locale&#10;&#10;private fun parseNumber(raw: String): Double? = raw.replace(',', '.').trim().toDoubleOrNull()&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun AddMaterialDialog(&#10;    onDismiss: () -&gt; Unit,&#10;    onAddMaterial: (Material) -&gt; Unit,&#10;    darkMode: Boolean,&#10;    existingMaterials: List&lt;Material&gt;&#10;) {&#10;    var materialName by remember { mutableStateOf(&quot;&quot;) }&#10;    var quantity by remember { mutableStateOf(&quot;&quot;) }&#10;    var capacityValue by remember { mutableStateOf(&quot;&quot;) }&#10;    val capacityUnits = listOf(&quot;ml&quot;, &quot;g&quot;)&#10;    var capacityUnit by remember { mutableStateOf(capacityUnits.first()) }&#10;    var preferredWickName by remember { mutableStateOf(&quot;&quot;) }&#10;    var preferredConcentration by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    val unitsBase = listOf(&quot;g&quot;, &quot;ml&quot;, &quot;szt&quot;, &quot;m&quot;)&#10;    var unit by remember { mutableStateOf(&quot;g&quot;) }&#10;    val categories = listOf(&quot;Wosk&quot;, &quot;Olejek&quot;, &quot;Knot&quot;, &quot;Pojemnik&quot;, &quot;Barwnik&quot;, &quot;Inne&quot;)&#10;    var category by remember { mutableStateOf(categories.first()) }&#10;&#10;    var nameExpanded by remember { mutableStateOf(false) }&#10;    val allMaterialNames = existingMaterials.map { it.name }.distinct()&#10;    val filteredMaterialNames = if (materialName.isBlank()) allMaterialNames else allMaterialNames.filter { it.contains(materialName, ignoreCase = true) }&#10;&#10;    val wicks = existingMaterials.filter { it.category == &quot;Knot&quot; }.map { it.name }&#10;&#10;    LaunchedEffect(category) {&#10;        unit = when (category) {&#10;            &quot;Pojemnik&quot; -&gt; &quot;szt&quot;&#10;            &quot;Knot&quot; -&gt; &quot;szt&quot;&#10;            &quot;Olejek&quot; -&gt; &quot;ml&quot;&#10;            else -&gt; &quot;g&quot;&#10;        }&#10;    }&#10;&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(&#10;            modifier = Modifier.padding(16.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = if (darkMode) Color(0xFF3B3B44) else Color.White)&#10;        ) {&#10;            Column(modifier = Modifier.padding(16.dp).fillMaxWidth()) {&#10;                Text(&quot;Dodaj nowy materiał&quot;, fontSize = 20.sp, fontWeight = FontWeight.SemiBold, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(16.dp))&#10;&#10;                // Nazwa + podpowiedzi&#10;                ExposedDropdownMenuBox(expanded = nameExpanded, onExpandedChange = { nameExpanded = !nameExpanded }) {&#10;                    OutlinedTextField(&#10;                        modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                        value = materialName,&#10;                        onValueChange = {&#10;                            materialName = it&#10;                            nameExpanded = true // otwórz menu przy wpisywaniu&#10;                        },&#10;                        label = { Text(&quot;Nazwa materiału&quot;) },&#10;                        trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = nameExpanded) }&#10;                    )&#10;                    if (nameExpanded &amp;&amp; filteredMaterialNames.isNotEmpty()) {&#10;                        ExposedDropdownMenu(expanded = nameExpanded, onDismissRequest = { nameExpanded = false }) {&#10;                            filteredMaterialNames.forEach { option -&gt;&#10;                                DropdownMenuItem(text = { Text(option) }, onClick = {&#10;                                    val selected = existingMaterials.find { it.name == option }&#10;                                    if (selected != null) {&#10;                                        category = selected.category&#10;                                        unit = selected.unit&#10;                                        preferredWickName = selected.preferredWickName ?: &quot;&quot;&#10;                                        preferredConcentration = selected.preferredConcentration?.toString() ?: &quot;&quot;&#10;                                        if (selected.category == &quot;Pojemnik&quot;) {&#10;                                            // wyodrębnij pojemność i jednostkę&#10;                                            val lastSpace = selected.name.lastIndexOf(' ')&#10;                                            if (lastSpace != -1) {&#10;                                                materialName = selected.name.substring(0, lastSpace)&#10;                                                val tail = selected.name.substring(lastSpace + 1)&#10;                                                val value = tail.filter { it.isDigit() }&#10;                                                val unitStr = tail.filter { it.isLetter() }&#10;                                                capacityValue = value&#10;                                                if (unitStr in capacityUnits) capacityUnit = unitStr&#10;                                            } else materialName = selected.name&#10;                                        } else materialName = selected.name&#10;                                    } else materialName = option&#10;                                    nameExpanded = false&#10;                                })&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                // Kategoria&#10;                var categoryExpanded by remember { mutableStateOf(false) }&#10;                ExposedDropdownMenuBox(expanded = categoryExpanded, onExpandedChange = { categoryExpanded = !categoryExpanded }) {&#10;                    OutlinedTextField(&#10;                        modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                        readOnly = true,&#10;                        value = category,&#10;                        onValueChange = {},&#10;                        label = { Text(&quot;Kategoria&quot;) },&#10;                        trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = categoryExpanded) }&#10;                    )&#10;                    ExposedDropdownMenu(expanded = categoryExpanded, onDismissRequest = { categoryExpanded = false }) {&#10;                        categories.forEach { option -&gt; DropdownMenuItem(text = { Text(option) }, onClick = { category = option; categoryExpanded = false }) }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                // Dynamiczne pola zależne od kategorii&#10;                when (category) {&#10;                    &quot;Pojemnik&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = capacityValue,&#10;                                onValueChange = { capacityValue = it },&#10;                                label = { Text(&quot;Pojemność&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var capUnitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = capUnitExpanded, onExpandedChange = { capUnitExpanded = !capUnitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = capacityUnit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = capUnitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = capUnitExpanded, onDismissRequest = { capUnitExpanded = false }) {&#10;                                    capacityUnits.forEach { cu -&gt; DropdownMenuItem(text = { Text(cu) }, onClick = { capacityUnit = cu; capUnitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = quantity,&#10;                            onValueChange = { quantity = it },&#10;                            label = { Text(&quot;Ilość (szt.)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                        )&#10;                        Spacer(Modifier.height(8.dp))&#10;                        // Preferowany knot&#10;                        var wickExpanded by remember { mutableStateOf(false) }&#10;                        ExposedDropdownMenuBox(expanded = wickExpanded, onExpandedChange = { wickExpanded = !wickExpanded }) {&#10;                            OutlinedTextField(&#10;                                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                                readOnly = true,&#10;                                value = preferredWickName,&#10;                                onValueChange = {},&#10;                                label = { Text(&quot;Preferowany knot&quot;) },&#10;                                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = wickExpanded) }&#10;                            )&#10;                            ExposedDropdownMenu(expanded = wickExpanded, onDismissRequest = { wickExpanded = false }) {&#10;                                wicks.forEach { w -&gt; DropdownMenuItem(text = { Text(w) }, onClick = { preferredWickName = w; wickExpanded = false }) }&#10;                            }&#10;                        }&#10;                    }&#10;                    &quot;Olejek&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            // Jednostka dla olejku (ml/g) uproszczenie&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    listOf(&quot;ml&quot;, &quot;g&quot;).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = preferredConcentration,&#10;                            onValueChange = { preferredConcentration = it },&#10;                            label = { Text(&quot;Preferowane stężenie (%)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                        )&#10;                    }&#10;                    else -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    (if (category == &quot;Knot&quot;) listOf(&quot;szt&quot;, &quot;m&quot;) else unitsBase).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;                var price by remember { mutableStateOf(&quot;&quot;) }&#10;                OutlinedTextField(&#10;                    value = price,&#10;                    onValueChange = { price = it },&#10;                    label = { Text(&quot;Cena całkowita (zł)&quot;) },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                )&#10;                Spacer(Modifier.height(16.dp))&#10;                Row(modifier = Modifier.align(Alignment.End)) {&#10;                    TextButton(onClick = onDismiss) { Text(&quot;Anuluj&quot;) }&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Button(onClick = {&#10;                        val finalName = if (category == &quot;Pojemnik&quot;) {&#10;                            &quot;${materialName.trim()} ${capacityValue.trim()}${capacityUnit}&quot;.trim()&#10;                        } else materialName.trim()&#10;                        val finalUnit = if (category == &quot;Pojemnik&quot;) &quot;szt&quot; else unit&#10;                        val newMaterial = Material(&#10;                            name = finalName,&#10;                            quantity = parseNumber(quantity) ?: 0.0,&#10;                            unit = finalUnit,&#10;                            price = parseNumber(price) ?: 0.0,&#10;                            category = category,&#10;                            preferredWickName = if (category == &quot;Pojemnik&quot;) preferredWickName.takeIf { it.isNotBlank() } else null,&#10;                            preferredConcentration = if (category == &quot;Olejek&quot;) parseNumber(preferredConcentration) else null&#10;                        )&#10;                        onAddMaterial(newMaterial)&#10;                    }, colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF7C3AED))) { Text(&quot;Dodaj&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun EditMaterialDialog(&#10;    material: Material,&#10;    onDismiss: () -&gt; Unit,&#10;    onEditMaterial: (Material) -&gt; Unit,&#10;    darkMode: Boolean,&#10;    existingMaterials: List&lt;Material&gt;&#10;) {&#10;    var materialName by remember { mutableStateOf(material.name) }&#10;    var quantity by remember { mutableStateOf(material.quantity.toString()) }&#10;    var capacityValue by remember { mutableStateOf(&quot;&quot;) }&#10;    val capacityUnits = listOf(&quot;ml&quot;, &quot;g&quot;)&#10;    var capacityUnit by remember { mutableStateOf(capacityUnits.first()) }&#10;    var preferredWickName by remember { mutableStateOf(material.preferredWickName ?: &quot;&quot;) }&#10;    var preferredConcentration by remember { mutableStateOf(material.preferredConcentration?.toString() ?: &quot;&quot;) }&#10;    var unit by remember { mutableStateOf(material.unit) }&#10;    val categories = listOf(&quot;Wosk&quot;, &quot;Olejek&quot;, &quot;Knot&quot;, &quot;Pojemnik&quot;, &quot;Barwnik&quot;, &quot;Inne&quot;)&#10;    var category by remember { mutableStateOf(material.category) }&#10;&#10;    LaunchedEffect(material) {&#10;        if (material.category == &quot;Pojemnik&quot;) {&#10;            val lastSpace = material.name.lastIndexOf(' ')&#10;            if (lastSpace != -1) {&#10;                materialName = material.name.substring(0, lastSpace)&#10;                val tail = material.name.substring(lastSpace + 1)&#10;                val value = tail.filter { it.isDigit() }&#10;                val unitStr = tail.filter { it.isLetter() }&#10;                capacityValue = value&#10;                if (unitStr in capacityUnits) capacityUnit = unitStr&#10;            }&#10;        }&#10;    }&#10;&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(&#10;            modifier = Modifier.padding(16.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = CardDefaults.cardColors(containerColor = if (darkMode) Color(0xFF3B3B44) else Color.White)&#10;        ) {&#10;            Column(modifier = Modifier.padding(16.dp).fillMaxWidth()) {&#10;                Text(&quot;Edytuj materiał&quot;, fontSize = 20.sp, fontWeight = FontWeight.SemiBold, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(16.dp))&#10;                OutlinedTextField(&#10;                    value = materialName,&#10;                    onValueChange = { materialName = it },&#10;                    label = { Text(&quot;Nazwa materiału&quot;) },&#10;                    modifier = Modifier.fillMaxWidth()&#10;                )&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                var categoryExpanded by remember { mutableStateOf(false) }&#10;                ExposedDropdownMenuBox(expanded = categoryExpanded, onExpandedChange = { categoryExpanded = !categoryExpanded }) {&#10;                    OutlinedTextField(&#10;                        modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                        readOnly = true,&#10;                        value = category,&#10;                        onValueChange = {},&#10;                        label = { Text(&quot;Kategoria&quot;) },&#10;                        trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = categoryExpanded) }&#10;                    )&#10;                    ExposedDropdownMenu(expanded = categoryExpanded, onDismissRequest = { categoryExpanded = false }) {&#10;                        categories.forEach { option -&gt; DropdownMenuItem(text = { Text(option) }, onClick = { category = option; categoryExpanded = false }) }&#10;                    }&#10;                }&#10;                Spacer(Modifier.height(8.dp))&#10;&#10;                when (category) {&#10;                    &quot;Pojemnik&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = capacityValue,&#10;                                onValueChange = { capacityValue = it },&#10;                                label = { Text(&quot;Pojemność&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var capUnitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = capUnitExpanded, onExpandedChange = { capUnitExpanded = !capUnitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = capacityUnit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = capUnitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = capUnitExpanded, onDismissRequest = { capUnitExpanded = false }) {&#10;                                    capacityUnits.forEach { cu -&gt; DropdownMenuItem(text = { Text(cu) }, onClick = { capacityUnit = cu; capUnitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = quantity,&#10;                            onValueChange = { quantity = it },&#10;                            label = { Text(&quot;Ilość (szt.)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                        )&#10;                        Spacer(Modifier.height(8.dp))&#10;                        var wickExpanded by remember { mutableStateOf(false) }&#10;                        val wicks = existingMaterials.filter { it.category == &quot;Knot&quot; }.map { it.name }&#10;                        ExposedDropdownMenuBox(expanded = wickExpanded, onExpandedChange = { wickExpanded = !wickExpanded }) {&#10;                            OutlinedTextField(&#10;                                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                                readOnly = true,&#10;                                value = preferredWickName,&#10;                                onValueChange = {},&#10;                                label = { Text(&quot;Preferowany knot&quot;) },&#10;                                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = wickExpanded) }&#10;                            )&#10;                            ExposedDropdownMenu(expanded = wickExpanded, onDismissRequest = { wickExpanded = false }) {&#10;                                wicks.forEach { w -&gt; DropdownMenuItem(text = { Text(w) }, onClick = { preferredWickName = w; wickExpanded = false }) }&#10;                            }&#10;                        }&#10;                    }&#10;                    &quot;Olejek&quot; -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    listOf(&quot;ml&quot;, &quot;g&quot;).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                        Spacer(Modifier.height(8.dp))&#10;                        OutlinedTextField(&#10;                            value = preferredConcentration,&#10;                            onValueChange = { preferredConcentration = it },&#10;                            label = { Text(&quot;Preferowane stężenie (%)&quot;) },&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                        )&#10;                    }&#10;                    else -&gt; {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            OutlinedTextField(&#10;                                value = quantity,&#10;                                onValueChange = { quantity = it },&#10;                                label = { Text(&quot;Ilość&quot;) },&#10;                                modifier = Modifier.weight(1f),&#10;                                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)&#10;                            )&#10;                            Spacer(Modifier.width(8.dp))&#10;                            var unitExpanded by remember { mutableStateOf(false) }&#10;                            val unitsBase = listOf(&quot;g&quot;, &quot;ml&quot;, &quot;szt&quot;, &quot;m&quot;)&#10;                            ExposedDropdownMenuBox(expanded = unitExpanded, onExpandedChange = { unitExpanded = !unitExpanded }) {&#10;                                OutlinedTextField(&#10;                                    modifier = Modifier.menuAnchor().width(90.dp),&#10;                                    readOnly = true,&#10;                                    value = unit,&#10;                                    onValueChange = {},&#10;                                    label = { Text(&quot;Jedn.&quot;) },&#10;                                    trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = unitExpanded) }&#10;                                )&#10;                                ExposedDropdownMenu(expanded = unitExpanded, onDismissRequest = { unitExpanded = false }) {&#10;                                    (if (category == &quot;Knot&quot;) listOf(&quot;szt&quot;, &quot;m&quot;) else unitsBase).forEach { u -&gt; DropdownMenuItem(text = { Text(u) }, onClick = { unit = u; unitExpanded = false }) }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(Modifier.height(8.dp))&#10;                var price by remember { mutableStateOf(material.price.toString()) }&#10;                OutlinedTextField(&#10;                    value = price,&#10;                    onValueChange = { price = it },&#10;                    label = { Text(&quot;Cena całkowita (zł)&quot;) },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal)&#10;                )&#10;                Spacer(Modifier.height(16.dp))&#10;                Row(modifier = Modifier.align(Alignment.End)) {&#10;                    TextButton(onClick = onDismiss) { Text(&quot;Anuluj&quot;) }&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Button(onClick = {&#10;                        val finalName = if (category == &quot;Pojemnik&quot;) {&#10;                            &quot;${materialName.trim()} ${capacityValue.trim()}${capacityUnit}&quot;.trim()&#10;                        } else materialName.trim()&#10;                        val finalUnit = if (category == &quot;Pojemnik&quot;) &quot;szt&quot; else unit&#10;                        val updated = material.copy(&#10;                            name = finalName,&#10;                            quantity = parseNumber(quantity) ?: 0.0,&#10;                            unit = finalUnit,&#10;                            price = parseNumber(price) ?: 0.0,&#10;                            category = category,&#10;                            preferredWickName = if (category == &quot;Pojemnik&quot;) preferredWickName.takeIf { it.isNotBlank() } else null,&#10;                            preferredConcentration = if (category == &quot;Olejek&quot;) parseNumber(preferredConcentration) else null&#10;                        )&#10;                        onEditMaterial(updated)&#10;                    }, colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF7C3AED))) { Text(&quot;Zapisz&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun RemoveMaterialDialog(&#10;    material: Material,&#10;    onDismiss: () -&gt; Unit,&#10;    onRemove: (Material, Double) -&gt; Unit,&#10;    darkMode: Boolean&#10;) {&#10;    var quantityToRemove by remember { mutableStateOf(&quot;&quot;) }&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(shape = RoundedCornerShape(16.dp), colors = CardDefaults.cardColors(containerColor = if (darkMode) Color(0xFF3B3B44) else Color.White)) {&#10;            Column(modifier = Modifier.padding(16.dp).fillMaxWidth(), horizontalAlignment = Alignment.Start) {&#10;                Text(&quot;Usuń materiał&quot;, fontSize = 20.sp, fontWeight = FontWeight.SemiBold, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(16.dp))&#10;                Text(String.format(Locale.getDefault(), &quot;Dostępna ilość: %.2f %s&quot;, material.quantity, material.unit), fontSize = 14.sp, color = if (darkMode) Color(0xFF9CA3AF) else Color(0xFF6B7280))&#10;                Spacer(Modifier.height(8.dp))&#10;                OutlinedTextField(value = quantityToRemove, onValueChange = { quantityToRemove = it }, label = { Text(&quot;Ilość do usunięcia&quot;) }, keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number))&#10;                Spacer(Modifier.height(8.dp))&#10;                TextButton(onClick = { quantityToRemove = String.format(Locale.getDefault(), &quot;%.2f&quot;, material.quantity) }) { Text(&quot;Wszystko&quot;) }&#10;                Spacer(Modifier.height(16.dp))&#10;                Row(modifier = Modifier.align(Alignment.End)) {&#10;                    TextButton(onClick = onDismiss) { Text(&quot;Anuluj&quot;) }&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Button(onClick = { onRemove(material, parseNumber(quantityToRemove) ?: 0.0) }, colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFEC4899))) { Text(&quot;Usuń&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/swieczkomat/ui/screens/CalculatorScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/swieczkomat/ui/screens/CalculatorScreen.kt" />
              <option name="originalContent" value="package com.example.swieczkomat.ui.screens&#10;&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.swieczkomat.data.Material&#10;import com.example.swieczkomat.vievmodels.MaterialsViewModel&#10;import com.example.swieczkomat.vievmodels.CandleViewModel&#10;import com.example.swieczkomat.ui.dialogs.SaveCandlesDialog&#10;import com.example.swieczkomat.ui.util.MaterialUtils&#10;import java.util.Locale&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun CalculatorTab(darkMode: Boolean, viewModel: MaterialsViewModel, candleViewModel: CandleViewModel) {&#10;    val materials by viewModel.getAllMaterials().collectAsState(initial = emptyList())&#10;    val textColor = if (darkMode) Color.White else Color.Black&#10;&#10;    var concentration by remember { mutableStateOf(&quot;5.0&quot;) }&#10;    var candleCount by remember { mutableStateOf(&quot;1&quot;) }&#10;    var selectedContainer by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var selectedWax by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var selectedFragrance by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var selectedWick by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var wickLength by remember { mutableStateOf(&quot;0.15&quot;) }&#10;    var selectedDye by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;&#10;    val containers = materials.filter { it.category == &quot;Pojemnik&quot; }&#10;    val waxes = materials.filter { it.category == &quot;Wosk&quot; }&#10;    val fragrances = materials.filter { it.category == &quot;Olejek&quot; }&#10;    val wicks = materials.filter { it.category == &quot;Knot&quot; }&#10;    val dyes = materials.filter { it.category == &quot;Barwnik&quot; }&#10;&#10;    var fragranceAmount by remember { mutableStateOf(0.0) }&#10;    var waxAmount by remember { mutableStateOf(0.0) }&#10;    var totalPrice by remember { mutableStateOf(0.0) }&#10;    var showSaveDialog by remember { mutableStateOf(false) }&#10;&#10;    LaunchedEffect(selectedContainer) {&#10;        selectedContainer?.preferredWickName?.let { wickName -&gt;&#10;            wicks.find { it.name == wickName }?.let { selectedWick = it }&#10;        }&#10;    }&#10;    LaunchedEffect(selectedFragrance) { selectedFragrance?.preferredConcentration?.let { concentration = it.toString() } }&#10;&#10;    LaunchedEffect(concentration, candleCount, selectedContainer, selectedWax, selectedFragrance, selectedWick, wickLength, selectedDye) {&#10;        val containerCapacity = selectedContainer?.let { MaterialUtils.extractCapacity(it.name) } ?: 0.0&#10;        val concentrationValue = concentration.replace(',', '.').toDoubleOrNull() ?: 0.0&#10;        val count = candleCount.toIntOrNull() ?: 1&#10;        val wickLengthValue = wickLength.replace(',', '.').toDoubleOrNull() ?: 0.0&#10;        if (containerCapacity &gt; 0 &amp;&amp; selectedWax != null &amp;&amp; count &gt; 0) {&#10;            val singleWaxAndFragrance = containerCapacity * 0.875&#10;            val singleFragranceAmount = singleWaxAndFragrance * (concentrationValue / 100.0)&#10;            val singleWaxAmount = singleWaxAndFragrance - singleFragranceAmount&#10;            val containerPrice = MaterialUtils.getPricePerUnit(selectedContainer)&#10;            val fragrancePrice = MaterialUtils.getPricePerUnit(selectedFragrance) * singleFragranceAmount&#10;            val wickPrice = when (selectedWick?.unit) {&#10;                &quot;m&quot; -&gt; MaterialUtils.getPricePerUnit(selectedWick) * wickLengthValue&#10;                &quot;szt&quot; -&gt; MaterialUtils.getPricePerUnit(selectedWick)&#10;                else -&gt; 0.0&#10;            }&#10;            val waxPrice = MaterialUtils.getPricePerUnit(selectedWax) * singleWaxAmount&#10;            val dyePrice = MaterialUtils.getPricePerUnit(selectedDye)&#10;            val singleCandlePrice = containerPrice + fragrancePrice + wickPrice + waxPrice + dyePrice&#10;            fragranceAmount = singleFragranceAmount * count&#10;            waxAmount = singleWaxAmount * count&#10;            totalPrice = singleCandlePrice * count&#10;        } else {&#10;            fragranceAmount = 0.0; waxAmount = 0.0; totalPrice = 0.0&#10;        }&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .verticalScroll(rememberScrollState())&#10;            .padding(horizontal = 12.dp, vertical = 12.dp)&#10;    ) {&#10;        Text(&#10;            &quot;Kalkulator Świeczek&quot;,&#10;            fontSize = 20.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            color = textColor,&#10;            modifier = Modifier.align(Alignment.CenterHorizontally)&#10;        )&#10;        Spacer(Modifier.height(12.dp))&#10;        OutlinedTextField(&#10;            value = concentration,&#10;            onValueChange = { concentration = it },&#10;            label = { Text(&quot;Stężenie zapachu (%)&quot;) },&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal),&#10;            modifier = Modifier.fillMaxWidth()&#10;        )&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var containerExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = containerExpanded,&#10;            onExpandedChange = { containerExpanded = !containerExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedContainer?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Pojemnik&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = containerExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = containerExpanded,&#10;                onDismissRequest = { containerExpanded = false }&#10;            ) {&#10;                containers.forEach { container -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(container.name) },&#10;                        onClick = {&#10;                            selectedContainer = container&#10;                            containerExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var waxExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = waxExpanded,&#10;            onExpandedChange = { waxExpanded = !waxExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedWax?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Wosk&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = waxExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = waxExpanded,&#10;                onDismissRequest = { waxExpanded = false }&#10;            ) {&#10;                waxes.forEach { wax -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(wax.name) },&#10;                        onClick = {&#10;                            selectedWax = wax&#10;                            waxExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var fragranceExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = fragranceExpanded,&#10;            onExpandedChange = { fragranceExpanded = !fragranceExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedFragrance?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Olejek&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = fragranceExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = fragranceExpanded,&#10;                onDismissRequest = { fragranceExpanded = false }&#10;            ) {&#10;                fragrances.forEach { fr -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(fr.name) },&#10;                        onClick = {&#10;                            selectedFragrance = fr&#10;                            fragranceExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var wickExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = wickExpanded,&#10;            onExpandedChange = { wickExpanded = !wickExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedWick?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Knot&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = wickExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = wickExpanded,&#10;                onDismissRequest = { wickExpanded = false }&#10;            ) {&#10;                wicks.forEach { wk -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(wk.name) },&#10;                        onClick = {&#10;                            selectedWick = wk&#10;                            wickExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        if (selectedWick?.unit == &quot;m&quot;) {&#10;            Spacer(Modifier.height(8.dp))&#10;            OutlinedTextField(&#10;                value = wickLength,&#10;                onValueChange = { wickLength = it },&#10;                label = { Text(&quot;Długość knota (m)&quot;) },&#10;                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal),&#10;                modifier = Modifier.fillMaxWidth()&#10;            )&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var dyeExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = dyeExpanded,&#10;            onExpandedChange = { dyeExpanded = !dyeExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedDye?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Barwnik (opcjonalnie)&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = dyeExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = dyeExpanded,&#10;                onDismissRequest = { dyeExpanded = false }&#10;            ) {&#10;                dyes.forEach { dy -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(dy.name) },&#10;                        onClick = {&#10;                            selectedDye = dy&#10;                            dyeExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(12.dp))&#10;        OutlinedTextField(&#10;            value = candleCount,&#10;            onValueChange = { candleCount = it },&#10;            label = { Text(&quot;Ilość świeczek&quot;) },&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),&#10;            modifier = Modifier.fillMaxWidth()&#10;        )&#10;        Spacer(Modifier.height(12.dp))&#10;        Column(modifier = Modifier.align(Alignment.Start)) {&#10;            Text(&#10;                &quot;Ilość zapachu: ${String.format(Locale.getDefault(), &quot;%.2f&quot;, fragranceAmount)} g/ml&quot;,&#10;                fontWeight = FontWeight.SemiBold,&#10;                color = textColor&#10;            )&#10;            Text(&#10;                &quot;Ilość wosku: ${String.format(Locale.getDefault(), &quot;%.2f&quot;, waxAmount)} g/ml&quot;,&#10;                fontWeight = FontWeight.SemiBold,&#10;                color = textColor&#10;            )&#10;            Spacer(Modifier.height(4.dp))&#10;            val count = candleCount.toIntOrNull() ?: 1&#10;            val priceText = if (count &gt; 1) &quot;Szacowana cena za $count świeczek&quot; else &quot;Szacowana cena świeczki&quot;&#10;            Text(&#10;                &quot;$priceText: ${String.format(Locale.getDefault(), &quot;%.2f&quot;, totalPrice)} zł&quot;,&#10;                fontWeight = FontWeight.Bold,&#10;                fontSize = 18.sp,&#10;                color = textColor&#10;            )&#10;        }&#10;        Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            OutlinedButton(onClick = {&#10;                concentration = &quot;5.0&quot;&#10;                candleCount = &quot;1&quot;&#10;                selectedContainer = null&#10;                selectedWax = null&#10;                selectedFragrance = null&#10;                selectedWick = null&#10;                wickLength = &quot;0.15&quot;&#10;                selectedDye = null&#10;            }) { Text(&quot;Wyczyść&quot;) }&#10;            Button(&#10;                enabled = selectedContainer != null &amp;&amp; selectedWax != null &amp;&amp; selectedFragrance != null &amp;&amp; selectedWick != null &amp;&amp; (candleCount.toIntOrNull() ?: 0) &gt; 0 &amp;&amp; totalPrice &gt; 0.0,&#10;                onClick = { showSaveDialog = true },&#10;                colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF7C3AED))&#10;            ) { Text(&quot;Zapisz świeczki&quot;) }&#10;        }&#10;        Spacer(Modifier.height(16.dp))&#10;    }&#10;    if (showSaveDialog) {&#10;        SaveCandlesDialog(&#10;            count = candleCount.toIntOrNull() ?: 1,&#10;            totalPrice = totalPrice,&#10;            container = selectedContainer,&#10;            wax = selectedWax,&#10;            fragrance = selectedFragrance,&#10;            wick = selectedWick,&#10;            dye = selectedDye,&#10;            concentration = concentration.replace(',', '.').toDoubleOrNull() ?: 0.0,&#10;            darkMode = darkMode,&#10;            onDismiss = { showSaveDialog = false },&#10;            onSave = { list -&gt;&#10;                candleViewModel.addCandles(list)&#10;                showSaveDialog = false&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.swieczkomat.ui.screens&#10;&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.foundation.text.KeyboardOptions&#10;import androidx.compose.ui.text.input.KeyboardType&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.swieczkomat.data.Material&#10;import com.example.swieczkomat.vievmodels.MaterialsViewModel&#10;import com.example.swieczkomat.vievmodels.CandleViewModel&#10;import com.example.swieczkomat.ui.dialogs.SaveCandlesDialog&#10;import com.example.swieczkomat.ui.util.MaterialUtils&#10;import java.util.Locale&#10;import androidx.compose.ui.window.Dialog&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun CalculatorTab(darkMode: Boolean, viewModel: MaterialsViewModel, candleViewModel: CandleViewModel) {&#10;    val materials by viewModel.getAllMaterials().collectAsState(initial = emptyList())&#10;    val textColor = if (darkMode) Color.White else Color.Black&#10;&#10;    var concentration by remember { mutableStateOf(&quot;5.0&quot;) }&#10;    var candleCount by remember { mutableStateOf(&quot;1&quot;) }&#10;    var selectedContainer by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var selectedWax by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var selectedFragrance by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var selectedWick by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;    var wickLength by remember { mutableStateOf(&quot;0.15&quot;) }&#10;    var selectedDye by remember { mutableStateOf&lt;Material?&gt;(null) }&#10;&#10;    val containers = materials.filter { it.category == &quot;Pojemnik&quot; }&#10;    val waxes = materials.filter { it.category == &quot;Wosk&quot; }&#10;    val fragrances = materials.filter { it.category == &quot;Olejek&quot; }&#10;    val wicks = materials.filter { it.category == &quot;Knot&quot; }&#10;    val dyes = materials.filter { it.category == &quot;Barwnik&quot; }&#10;&#10;    var fragranceAmount by remember { mutableStateOf(0.0) }&#10;    var waxAmount by remember { mutableStateOf(0.0) }&#10;    var totalPrice by remember { mutableStateOf(0.0) }&#10;    var showSaveDialog by remember { mutableStateOf(false) }&#10;    var showDetailsDialog by remember { mutableStateOf(false) }&#10;&#10;    // Koszty per świeczkę (cząstkowe)&#10;    var containerCostPerCandle by remember { mutableStateOf(0.0) }&#10;    var waxCostPerCandle by remember { mutableStateOf(0.0) }&#10;    var fragranceCostPerCandle by remember { mutableStateOf(0.0) }&#10;    var wickCostPerCandle by remember { mutableStateOf(0.0) }&#10;    var dyeCostPerCandle by remember { mutableStateOf(0.0) }&#10;&#10;    // Zużycie (obliczane dynamicznie)&#10;    var containerConsumption by remember { mutableStateOf(0.0) }&#10;    var waxConsumption by remember { mutableStateOf(0.0) }&#10;    var fragranceConsumption by remember { mutableStateOf(0.0) }&#10;    var wickConsumption by remember { mutableStateOf(0.0) }&#10;    var dyeConsumption by remember { mutableStateOf(0.0) }&#10;&#10;    LaunchedEffect(selectedContainer) {&#10;        selectedContainer?.preferredWickName?.let { wickName -&gt;&#10;            wicks.find { it.name == wickName }?.let { selectedWick = it }&#10;        }&#10;    }&#10;    LaunchedEffect(selectedFragrance) { selectedFragrance?.preferredConcentration?.let { concentration = it.toString() } }&#10;&#10;    LaunchedEffect(concentration, candleCount, selectedContainer, selectedWax, selectedFragrance, selectedWick, wickLength, selectedDye) {&#10;        val count = candleCount.toIntOrNull() ?: 1&#10;        val concentrationValue = concentration.replace(',', '.').toDoubleOrNull() ?: 0.0&#10;        val wickLengthValue = wickLength.replace(',', '.').toDoubleOrNull() ?: 0.0&#10;        val dyeAmountPerCandle = if (selectedDye != null) 0.05 else 0.0&#10;&#10;        // Reset zużyć&#10;        containerConsumption = 0.0&#10;        waxConsumption = 0.0&#10;        fragranceConsumption = 0.0&#10;        wickConsumption = 0.0&#10;        dyeConsumption = 0.0&#10;        fragranceAmount = 0.0&#10;        waxAmount = 0.0&#10;&#10;        var singleCandlePrice = 0.0&#10;&#10;        // Pojemnik – dostępny od razu&#10;        if (selectedContainer != null) {&#10;            val unitCost = MaterialUtils.getPricePerUnit(selectedContainer)&#10;            singleCandlePrice += unitCost&#10;            containerCostPerCandle = unitCost&#10;            containerConsumption = count.toDouble()&#10;        }&#10;&#10;        // Wosk + zapach – wymagają pojemnika i wosku (zapach opcjonalny, jeśli brak to 0)&#10;        val containerCapacity = selectedContainer?.let { MaterialUtils.extractCapacity(it.name) } ?: 0.0&#10;        if (selectedContainer != null &amp;&amp; selectedWax != null &amp;&amp; containerCapacity &gt; 0) {&#10;            // FORMUŁA: potrzebna ilość wosku = pojemność*0.875 - ilość olejku&#10;            // gdzie ilość olejku = pojemność*0.875*stężenie zapachu (stężenie traktowane jako ułamek lub % jeśli &gt;1)&#10;            val fillBase = containerCapacity * 0.875&#10;            val fragranceFraction = if (selectedFragrance != null) {&#10;                // Jeśli użytkownik wpisuje np. 5.0 mamy 5%, więc dzielimy przez 100; jeśli np. 0.05 traktujemy jako ułamek już.&#10;                if (concentrationValue &gt; 1.0) concentrationValue / 100.0 else concentrationValue&#10;            } else 0.0&#10;            val fragranceNeeded = fillBase * fragranceFraction&#10;            val waxNeeded = fillBase - fragranceNeeded&#10;&#10;            // Ilości całkowite dla wszystkich świeczek&#10;            fragranceAmount = fragranceNeeded * count&#10;            waxAmount = waxNeeded * count&#10;&#10;            // Zużycia&#10;            waxConsumption = waxAmount&#10;            fragranceConsumption = fragranceAmount&#10;&#10;            // Koszt wosku: (cena całkowita / ilość całkowita) * potrzebna ilość wosku&#10;            val waxUnitCost = if (selectedWax!!.quantity &gt; 0) selectedWax!!.price / selectedWax!!.quantity else 0.0&#10;            val waxPricePart = waxUnitCost * waxNeeded&#10;            singleCandlePrice += waxPricePart&#10;            waxCostPerCandle = waxPricePart&#10;&#10;            // Koszt olejku jeśli jest wybrany&#10;            if (selectedFragrance != null) {&#10;                val fragranceUnitCost = if (selectedFragrance!!.quantity &gt; 0) selectedFragrance!!.price / selectedFragrance!!.quantity else 0.0&#10;                val fragrancePricePart = fragranceUnitCost * fragranceNeeded&#10;                singleCandlePrice += fragrancePricePart&#10;                fragranceCostPerCandle = fragrancePricePart&#10;            }&#10;        }&#10;&#10;        // Knot – jeśli wybrany&#10;        if (selectedWick != null) {&#10;            wickConsumption = if (selectedWick!!.unit == &quot;m&quot;) wickLengthValue * count else count.toDouble()&#10;            val wickUnitCost = when (selectedWick!!.unit) {&#10;                &quot;m&quot; -&gt; MaterialUtils.getPricePerUnit(selectedWick) * wickLengthValue&#10;                &quot;szt&quot; -&gt; MaterialUtils.getPricePerUnit(selectedWick)&#10;                else -&gt; 0.0&#10;            }&#10;            singleCandlePrice += wickUnitCost&#10;            wickCostPerCandle = wickUnitCost&#10;        }&#10;&#10;        // Barwnik – stała ilość na świeczkę jeśli wybrany&#10;        if (selectedDye != null) {&#10;            dyeConsumption = dyeAmountPerCandle * count&#10;            val dyeCostPart = MaterialUtils.getPricePerUnit(selectedDye) * dyeAmountPerCandle&#10;            singleCandlePrice += dyeCostPart&#10;            dyeCostPerCandle = dyeCostPart&#10;        }&#10;&#10;        totalPrice = singleCandlePrice * count&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .verticalScroll(rememberScrollState())&#10;            .padding(horizontal = 12.dp, vertical = 12.dp)&#10;    ) {&#10;        Text(&#10;            &quot;Kalkulator Świeczek&quot;,&#10;            fontSize = 20.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            color = textColor,&#10;            modifier = Modifier.align(Alignment.CenterHorizontally)&#10;        )&#10;        Spacer(Modifier.height(12.dp))&#10;        OutlinedTextField(&#10;            value = concentration,&#10;            onValueChange = { concentration = it },&#10;            label = { Text(&quot;Stężenie zapachu (%)&quot;) },&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal),&#10;            modifier = Modifier.fillMaxWidth()&#10;        )&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var containerExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = containerExpanded,&#10;            onExpandedChange = { containerExpanded = !containerExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedContainer?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Pojemnik&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = containerExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = containerExpanded,&#10;                onDismissRequest = { containerExpanded = false }&#10;            ) {&#10;                containers.forEach { container -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(container.name) },&#10;                        onClick = {&#10;                            selectedContainer = container&#10;                            containerExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var waxExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = waxExpanded,&#10;            onExpandedChange = { waxExpanded = !waxExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedWax?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Wosk&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = waxExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = waxExpanded,&#10;                onDismissRequest = { waxExpanded = false }&#10;            ) {&#10;                waxes.forEach { wax -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(wax.name) },&#10;                        onClick = {&#10;                            selectedWax = wax&#10;                            waxExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var fragranceExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = fragranceExpanded,&#10;            onExpandedChange = { fragranceExpanded = !fragranceExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedFragrance?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Olejek&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = fragranceExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = fragranceExpanded,&#10;                onDismissRequest = { fragranceExpanded = false }&#10;            ) {&#10;                fragrances.forEach { fr -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(fr.name) },&#10;                        onClick = {&#10;                            selectedFragrance = fr&#10;                            fragranceExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var wickExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = wickExpanded,&#10;            onExpandedChange = { wickExpanded = !wickExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedWick?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Knot&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = wickExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = wickExpanded,&#10;                onDismissRequest = { wickExpanded = false }&#10;            ) {&#10;                wicks.forEach { wk -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(wk.name) },&#10;                        onClick = {&#10;                            selectedWick = wk&#10;                            wickExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        if (selectedWick?.unit == &quot;m&quot;) {&#10;            Spacer(Modifier.height(8.dp))&#10;            OutlinedTextField(&#10;                value = wickLength,&#10;                onValueChange = { wickLength = it },&#10;                label = { Text(&quot;Długość knota (m)&quot;) },&#10;                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Decimal),&#10;                modifier = Modifier.fillMaxWidth()&#10;            )&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;&#10;        var dyeExpanded by remember { mutableStateOf(false) }&#10;        ExposedDropdownMenuBox(&#10;            expanded = dyeExpanded,&#10;            onExpandedChange = { dyeExpanded = !dyeExpanded }&#10;        ) {&#10;            OutlinedTextField(&#10;                modifier = Modifier.menuAnchor().fillMaxWidth(),&#10;                readOnly = true,&#10;                value = selectedDye?.name ?: &quot;&quot;,&#10;                onValueChange = {},&#10;                label = { Text(&quot;Barwnik (opcjonalnie)&quot;) },&#10;                trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = dyeExpanded) },&#10;            )&#10;            ExposedDropdownMenu(&#10;                expanded = dyeExpanded,&#10;                onDismissRequest = { dyeExpanded = false }&#10;            ) {&#10;                dyes.forEach { dy -&gt;&#10;                    DropdownMenuItem(&#10;                        text = { Text(dy.name) },&#10;                        onClick = {&#10;                            selectedDye = dy&#10;                            dyeExpanded = false&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;        }&#10;        Spacer(Modifier.height(12.dp))&#10;        OutlinedTextField(&#10;            value = candleCount,&#10;            onValueChange = { candleCount = it },&#10;            label = { Text(&quot;Ilość świeczek&quot;) },&#10;            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number),&#10;            modifier = Modifier.fillMaxWidth()&#10;        )&#10;        Spacer(Modifier.height(12.dp))&#10;        Column(modifier = Modifier.align(Alignment.Start)) {&#10;            Text(&#10;                &quot;Ilość zapachu: ${String.format(Locale.getDefault(), &quot;%.2f&quot;, fragranceAmount)} g/ml&quot;,&#10;                fontWeight = FontWeight.SemiBold,&#10;                color = textColor&#10;            )&#10;            Text(&#10;                &quot;Ilość wosku: ${String.format(Locale.getDefault(), &quot;%.2f&quot;, waxAmount)} g/ml&quot;,&#10;                fontWeight = FontWeight.SemiBold,&#10;                color = textColor&#10;            )&#10;            Spacer(Modifier.height(4.dp))&#10;            val count = candleCount.toIntOrNull() ?: 1&#10;            val priceText = if (count &gt; 1) &quot;Szacowana cena za $count świeczek&quot; else &quot;Szacowana cena świeczki&quot;&#10;            Text(&#10;                &quot;$priceText: ${String.format(Locale.getDefault(), &quot;%.2f&quot;, totalPrice)} zł&quot;,&#10;                fontWeight = FontWeight.Bold,&#10;                fontSize = 18.sp,&#10;                color = textColor&#10;            )&#10;            // Walidacja dostępnych ilości materiałów&#10;            val c = selectedContainer&#10;            val w = selectedWax&#10;            val f = selectedFragrance&#10;            val k = selectedWick&#10;            val d = selectedDye&#10;            val insufficientMessages = buildList {&#10;                if (c != null &amp;&amp; c.quantity &lt; containerConsumption) add(&quot;Brak wystarczającej ilości pojemników (${String.format(Locale.getDefault(),&quot;%.0f&quot;, c.quantity)} &lt; ${containerConsumption.toInt()})&quot;)&#10;                if (w != null &amp;&amp; w.quantity &lt; waxConsumption) add(&quot;Za mało wosku (${String.format(Locale.getDefault(),&quot;%.2f&quot;, w.quantity)} &lt; ${String.format(Locale.getDefault(),&quot;%.2f&quot;, waxConsumption)})&quot;)&#10;                if (f != null &amp;&amp; f.quantity &lt; fragranceConsumption) add(&quot;Za mało olejku (${String.format(Locale.getDefault(),&quot;%.2f&quot;, f.quantity)} &lt; ${String.format(Locale.getDefault(),&quot;%.2f&quot;, fragranceConsumption)})&quot;)&#10;                if (k != null &amp;&amp; k.quantity &lt; wickConsumption) add(&quot;Za mało knotów${if (k.unit == &quot;m&quot;) &quot; (m)&quot; else &quot; (szt.)&quot;}&quot;)&#10;                if (d != null &amp;&amp; d.quantity &lt; dyeConsumption) add(&quot;Za mało barwnika (potrzeba ${String.format(Locale.getDefault(),&quot;%.2f&quot;, dyeConsumption)} ${d.unit})&quot;)&#10;            }&#10;            if (insufficientMessages.isNotEmpty()) {&#10;                Spacer(Modifier.height(6.dp))&#10;                insufficientMessages.forEach { msg -&gt; Text(msg, color = Color.Red, fontSize = 12.sp) }&#10;            }&#10;        }&#10;        Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            OutlinedButton(onClick = {&#10;                concentration = &quot;5.0&quot;&#10;                candleCount = &quot;1&quot;&#10;                selectedContainer = null&#10;                selectedWax = null&#10;                selectedFragrance = null&#10;                selectedWick = null&#10;                wickLength = &quot;0.15&quot;&#10;                selectedDye = null&#10;            }) { Text(&quot;Wyczyść&quot;) }&#10;            Button(&#10;                enabled = selectedContainer != null &amp;&amp; selectedWax != null &amp;&amp; selectedFragrance != null &amp;&amp; selectedWick != null &amp;&amp; (candleCount.toIntOrNull() ?: 0) &gt; 0 &amp;&amp; totalPrice &gt; 0.0 &amp;&amp;&#10;                        (selectedContainer?.quantity ?: 0.0) &gt;= containerConsumption &amp;&amp;&#10;                        (selectedWax?.quantity ?: 0.0) &gt;= waxConsumption &amp;&amp;&#10;                        (selectedFragrance?.quantity ?: 0.0) &gt;= fragranceConsumption &amp;&amp;&#10;                        (selectedWick?.quantity ?: 0.0) &gt;= wickConsumption &amp;&amp;&#10;                        (selectedDye?.quantity ?: Double.MAX_VALUE) &gt;= dyeConsumption,&#10;                onClick = { showSaveDialog = true },&#10;                colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF7C3AED))&#10;            ) { Text(&quot;Zapisz świeczki&quot;) }&#10;            OutlinedButton(&#10;                enabled = (candleCount.toIntOrNull() ?: 0) &gt; 0 &amp;&amp; (containerCostPerCandle + waxCostPerCandle + fragranceCostPerCandle + wickCostPerCandle + dyeCostPerCandle) &gt; 0.0,&#10;                onClick = { showDetailsDialog = true }&#10;            ) { Text(&quot;Szczegóły&quot;) }&#10;        }&#10;        Spacer(Modifier.height(16.dp))&#10;    }&#10;    if (showSaveDialog) {&#10;        SaveCandlesDialog(&#10;            count = candleCount.toIntOrNull() ?: 1,&#10;            totalPrice = totalPrice,&#10;            container = selectedContainer,&#10;            wax = selectedWax,&#10;            fragrance = selectedFragrance,&#10;            wick = selectedWick,&#10;            dye = selectedDye,&#10;            concentration = concentration.replace(',', '.').toDoubleOrNull() ?: 0.0,&#10;            darkMode = darkMode,&#10;            onDismiss = { showSaveDialog = false },&#10;            onSave = { list -&gt;&#10;                // Odjęcie zużytych materiałów z magazynu&#10;                selectedContainer?.let { viewModel.removeMaterial(it, containerConsumption) }&#10;                selectedWax?.let { viewModel.removeMaterial(it, waxConsumption) }&#10;                selectedFragrance?.let { viewModel.removeMaterial(it, fragranceConsumption) }&#10;                selectedWick?.let { viewModel.removeMaterial(it, wickConsumption) }&#10;                if (selectedDye != null &amp;&amp; dyeConsumption &gt; 0) viewModel.removeMaterial(selectedDye!!, dyeConsumption)&#10;                candleViewModel.addCandles(list)&#10;                showSaveDialog = false&#10;            }&#10;        )&#10;    }&#10;    if (showDetailsDialog) {&#10;        DetailsCostDialog(&#10;            darkMode = darkMode,&#10;            count = candleCount.toIntOrNull() ?: 1,&#10;            container = selectedContainer?.name,&#10;            wax = selectedWax?.name,&#10;            fragrance = selectedFragrance?.name,&#10;            wick = selectedWick?.name,&#10;            dye = selectedDye?.name,&#10;            containerCost = containerCostPerCandle,&#10;            waxCost = waxCostPerCandle,&#10;            fragranceCost = fragranceCostPerCandle,&#10;            wickCost = wickCostPerCandle,&#10;            dyeCost = dyeCostPerCandle,&#10;            totalSingle = containerCostPerCandle + waxCostPerCandle + fragranceCostPerCandle + wickCostPerCandle + dyeCostPerCandle,&#10;            onDismiss = { showDetailsDialog = false }&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun DetailsCostDialog(&#10;    darkMode: Boolean,&#10;    count: Int,&#10;    container: String?,&#10;    wax: String?,&#10;    fragrance: String?,&#10;    wick: String?,&#10;    dye: String?,&#10;    containerCost: Double,&#10;    waxCost: Double,&#10;    fragranceCost: Double,&#10;    wickCost: Double,&#10;    dyeCost: Double,&#10;    totalSingle: Double,&#10;    onDismiss: () -&gt; Unit&#10;) {&#10;    val bgColor = if (darkMode) Color(0xFF3B3B44) else Color.White&#10;    Dialog(onDismissRequest = onDismiss) {&#10;        Card(colors = CardDefaults.cardColors(containerColor = bgColor)) {&#10;            Column(modifier = Modifier.padding(16.dp).widthIn(min = 260.dp)) {&#10;                Text(&quot;Rozbicie kosztów&quot;, fontWeight = FontWeight.Bold, fontSize = 18.sp, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(12.dp))&#10;                CostLine(&quot;Pojemnik&quot;, container, containerCost, count, darkMode)&#10;                CostLine(&quot;Wosk&quot;, wax, waxCost, count, darkMode)&#10;                CostLine(&quot;Olejek&quot;, fragrance, fragranceCost, count, darkMode)&#10;                CostLine(&quot;Knot&quot;, wick, wickCost, count, darkMode)&#10;                CostLine(&quot;Barwnik&quot;, dye, dyeCost, count, darkMode)&#10;                HorizontalDivider(Modifier.padding(vertical = 8.dp))&#10;                Text(&quot;Suma / świeczkę: ${String.format(Locale.getDefault(), &quot;%.2f zł&quot;, totalSingle)}&quot;, fontWeight = FontWeight.SemiBold, color = if (darkMode) Color.White else Color.Black)&#10;                Text(&quot;Suma / ${count} świeczek: ${String.format(Locale.getDefault(), &quot;%.2f zł&quot;, totalSingle * count)}&quot;, fontWeight = FontWeight.Bold, color = if (darkMode) Color.White else Color.Black)&#10;                Spacer(Modifier.height(12.dp))&#10;                Row(modifier = Modifier.align(Alignment.End)) {&#10;                    TextButton(onClick = onDismiss) { Text(&quot;Zamknij&quot;) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun CostLine(label: String, name: String?, perCandle: Double, count: Int, darkMode: Boolean) {&#10;    val textColor = if (darkMode) Color.White else Color.Black&#10;    Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {&#10;        Column(modifier = Modifier.weight(1f)) {&#10;            Text(label, fontWeight = FontWeight.Medium, color = textColor)&#10;            Text(name ?: &quot;-&quot;, fontSize = 12.sp, color = if (darkMode) Color(0xFF9CA3AF) else Color(0xFF6B7280))&#10;        }&#10;        Column(horizontalAlignment = Alignment.End) {&#10;            Text(String.format(Locale.getDefault(), &quot;%.2f zł&quot;, perCandle), fontSize = 12.sp, color = textColor)&#10;            Text(String.format(Locale.getDefault(), &quot;%.2f zł&quot;, perCandle * count), fontSize = 12.sp, color = textColor)&#10;        }&#10;    }&#10;    Spacer(Modifier.height(6.dp))&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>